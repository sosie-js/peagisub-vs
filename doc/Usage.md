# Usage

This is a lua helper to set the path needed by the python bridge between aegisub and vapoursynth [aegisub-vs.py](https://raw.githubusercontent.com/arch1t3cht/Aegisub/vapoursynth/automation/vapoursynth/aegisub_vs.py) so that the ensure_plugin function can work after set_path being called.

```python
from dataclasses import dataclass, field
import os, sys

### Config path detection  ########################

import re

@dataclass 
class Vsvars():
    
    _vars = None
    
    #Get ?user specifier path saved in config vsvars.json generated from lua
    def get_userdir(self):
        
        import platform

        system=platform.system()

        if system== 'Windows':
            osname = "Windows" 

        if system== 'Linux':
            osname = "Unix"
        
        if system== 'Darwin':
            osname = "Macintosh"

        if osname == "Windows" :
            home = os.getenv('appdata')
            user_dir= "Aegisub"

        if osname == "Unix":
            home = os.getenv('HOME')
            user_dir=".aegisub"

        if osname == "Macintosh" :
            home = os.getenv('HOME')
            user_dir= "Library/Application Support/Aegisub"
            
        return str(os.path.join(home, user_dir))
    
    def get_config_file(self):
        userdir=self.get_userdir(self)
        return str(os.path.join(userdir,"vsvars.json"))   
    
    def _get_datadir(self) :
        json_file_path=self.get_config_file(self)
        dirs={}
        if not os.path.exists(json_file_path):
            sys.stderr.write("ERROR(aegisub_vs.vpy): Aegisub config vsvars.json (generated by aegisub_vs.lua) is missing")
        
        with open(json_file_path, 'r') as file:
            json = file.read() #json.loads(j.read())
            p = re.compile('\s+"([^"]+)"\s+:\s+"([^"]+)"')
            paths=p.findall(json)
            for k, v in paths:
                dirs[k] = v
        
        #extra to keep a track
        dirs["config"] = json_file_path
        return dirs
    
    @classmethod        
    def get(self, name):
        if self._vars is None:
             self._vars=self._get_datadir(self)
        try:
            return self._vars[name]
        except:
            return  "?"


import aegisub_vs as a
__aegi_vscache =  Vsvars.get("cache")
__aegi_vsplugins =   Vsvars.get("UserPluginDir")
a.set_paths(locals())
    
```
